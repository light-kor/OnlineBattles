# OnlineBattles
Сетевая игра с мини-играми на двоих

Данный проект был задуман как учебный, для получения опыта сетевой разработки. В данном проекте не были использование никакие готовые решения, а все сетевые взаимодействия построены на подклассах System.Net.Sockets.Socket (TcpClient, TcpListener и UdpClient). Также вся сетевая система строилась как отдельная библиотека, поэтому может быть подключена к любому другому проекту за короткое время.

Главными сложностями проекта стали: система уведомлений для игрока, система подключения и автоматического дисконнекта/реконнекта, а также система шаблонов, которые будут использоваться в каждой мини-игре, что позволяет скрыть от разработчика мини-игр все вопросы с сетью.

Для того, чтобы отделить разработку самих мини-игр от повторяющегося UI или стандартных сообщений об игровых событиях, вся повторяющаяся логика была вынесена в префаб GameControllers, в котором реализуется работа с табло счёта, таймер в начале игры и сообщениями об окончании игры, паузе, дисконнекте и прочее. Все эти скрипты находятся в папке OnlineBattles\Assets\Scripts\Games\0_General и интегрируются в новую мини-игру лишь за счёт переноса префаба на сцену.
Также для удобного перехода от обычных сетевых классов к классам, наследуемым от MonoBehaviour, были созданы классы-шаблоны. В каждой мини-игре есть своя архитектура классов, основанная на этих трёх родительских: GeneralController, GameTemplate_Online, GameTemplate_WifiHost, они обрабатывают все стандартные игровые события и выполняют их в основном потоке Unity. Классы GameResources_n наследуются от класса GeneralController, что открывает каждой игре доступ к стандартным UI компонентам и функциями работы с ними. Классы Game_Host_n наследуются от GameTemplate_WifiHost, а классы Game_Online_n наследуются от GameTemplate_Online, что позволяет автоматически подписываться скриптам на все необходимые игровые события. Также для удобства был создан класс TemplateMonoInvoker, который вызывает кастомные методы Start, Update, OnDestroy и другие у классов-шаблонов, что позволяет наследникам этих классов не переопределять данные методы, повышает удобство и уменьшает шанс на ошибку.

За создание клиентского соединения отвечают два класса: TCPConnect и UDPConnect, они реализуют классы TcpClient и UdpClient соответственно. Над ними стоит класс Network, который используется как оболочка для обоих этих классов, и скрывает от пользователя все сетевые вопросы (создание соединения, функции реконнекта, обработку служебных сообщений, автоматический дисконнект). 
При игре в локальной сети, на стороне клиента используется класс WifiServer_Connect, который использует класс Network для создания TCP соединения, а также класс WifiServer_Searcher для поиска доступных серверов в сети.
На стороне хоста, при игре в локальной сети, используется WifiServer_Host, который реализует класс TcpListener и поэтапно обрабатывает подключившихся игроков, и класс WifiServer_Searcher для поиска входящих локальных подключений. Для работы с UDP сообщениями хост также использует класс Network.

Демонстрация рабочей версии приложения (видео): https://drive.google.com/file/d/1Pw-v3au0s9e0ca7EGyWoRn0bgRtiGNgc/view?usp=sharing
